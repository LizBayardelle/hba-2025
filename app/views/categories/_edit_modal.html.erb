<!-- Edit Category Modal -->
<div x-show="showEditModal" @click.self="showEditModal = false" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" style="display: none;">
  <div @click.stop class="bg-white rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
    <h2 class="text-2xl font-bold mb-6 display-font" style="color: #1d3e4c;">Edit Category</h2>

    <%= form_with model: category, url: category_path(category), method: :patch, local: true do |f| %>
      <!-- Preview Box -->
      <div class="mb-6">
        <p class="text-xs font-semibold mb-2" style="color: #566e78;">PREVIEW</p>
        <div class="p-4 rounded-lg border-2" :style="'background-color: ' + colorMap[selectedColor].light + '; border-color: ' + selectedColor">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg flex items-center justify-center shadow-sm" :style="'background-color: ' + selectedColor">
              <i :class="'fa-solid ' + selectedIcon" class="text-white"></i>
            </div>
            <span class="font-bold display-font" :style="'color: ' + colorMap[selectedColor].dark" x-text="categoryName || 'My Category'"></span>
          </div>
        </div>
      </div>

      <!-- Category Name -->
      <div class="mb-5">
        <%= f.label :name, "Category Name", class: "block text-sm font-semibold mb-2", style: "color: #1d3e4c;" %>
        <%= f.text_field :name, "x-model": "categoryName", class: "w-full px-4 py-3 rounded-lg border-2 focus:outline-none transition font-light", style: "border-color: #E8EEF1; color: #1d3e4c;" %>
      </div>

      <!-- Description -->
      <div class="mb-5">
        <%= f.label :description, "Description (Optional)", class: "block text-sm font-semibold mb-2", style: "color: #1d3e4c;" %>
        <%= f.text_area :description, "x-model": "categoryDescription", rows: 2, class: "w-full px-4 py-3 rounded-lg border-2 focus:outline-none transition font-light resize-none", style: "border-color: #E8EEF1; color: #1d3e4c;" %>
      </div>

      <!-- Hidden fields for color and icon -->
      <%= f.hidden_field :color, "x-model": "selectedColor" %>
      <%= f.hidden_field :icon, "x-model": "selectedIcon" %>

      <!-- Icon Selector -->
      <div class="mb-5">
        <label class="block text-sm font-semibold mb-2" style="color: #1d3e4c;">Icon</label>
        <div class="grid grid-cols-6 md:grid-cols-9 gap-2 max-w-md">
          <button type="button" @click="selectedIcon = 'fa-check'" :class="selectedIcon === 'fa-check' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-check text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-dumbbell'" :class="selectedIcon === 'fa-dumbbell' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-dumbbell text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-book'" :class="selectedIcon === 'fa-book' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-book text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-heart'" :class="selectedIcon === 'fa-heart' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-heart text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-briefcase'" :class="selectedIcon === 'fa-briefcase' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-briefcase text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-utensils'" :class="selectedIcon === 'fa-utensils' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-utensils text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-bed'" :class="selectedIcon === 'fa-bed' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-bed text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-apple-whole'" :class="selectedIcon === 'fa-apple-whole' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-apple-whole text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-mug-hot'" :class="selectedIcon === 'fa-mug-hot' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-mug-hot text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-person-running'" :class="selectedIcon === 'fa-person-running' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-person-running text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-pills'" :class="selectedIcon === 'fa-pills' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-pills text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-brain'" :class="selectedIcon === 'fa-brain' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-brain text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-music'" :class="selectedIcon === 'fa-music' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-music text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-paintbrush'" :class="selectedIcon === 'fa-paintbrush' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-paintbrush text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-droplet'" :class="selectedIcon === 'fa-droplet' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-droplet text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-users'" :class="selectedIcon === 'fa-users' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-users text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-star'" :class="selectedIcon === 'fa-star' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-star text-base" style="color: #1d3e4c;"></i>
          </button>
          <button type="button" @click="selectedIcon = 'fa-pen'" :class="selectedIcon === 'fa-pen' ? 'border-theme-blue bg-theme-blue-light/10' : 'border-gray-200'" class="w-10 h-10 rounded-lg border-2 hover:border-theme-blue flex items-center justify-center transition">
            <i class="fa-solid fa-pen text-base" style="color: #1d3e4c;"></i>
          </button>
        </div>
      </div>

      <!-- Color Selector -->
      <div class="mb-6">
        <label class="block text-sm font-semibold mb-2" style="color: #1d3e4c;">Color</label>
        <div class="grid grid-cols-7 md:grid-cols-14 gap-2 max-w-md">
          <button type="button" @click="selectedColor = '#6B8A99'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#6B8A99' ? 'border-gray-800' : 'border-white'" style="background-color: #6B8A99;">
            <i x-show="selectedColor === '#6B8A99'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#9C8B7E'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#9C8B7E' ? 'border-gray-800' : 'border-white'" style="background-color: #9C8B7E;">
            <i x-show="selectedColor === '#9C8B7E'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#F8796D'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#F8796D' ? 'border-gray-800' : 'border-white'" style="background-color: #F8796D;">
            <i x-show="selectedColor === '#F8796D'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#FFA07A'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#FFA07A' ? 'border-gray-800' : 'border-white'" style="background-color: #FFA07A;">
            <i x-show="selectedColor === '#FFA07A'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#E5C730'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#E5C730' ? 'border-gray-800' : 'border-white'" style="background-color: #E5C730;">
            <i x-show="selectedColor === '#E5C730'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#A8A356'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#A8A356' ? 'border-gray-800' : 'border-white'" style="background-color: #A8A356;">
            <i x-show="selectedColor === '#A8A356'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#7CB342'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#7CB342' ? 'border-gray-800' : 'border-white'" style="background-color: #7CB342;">
            <i x-show="selectedColor === '#7CB342'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#6EE7B7'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#6EE7B7' ? 'border-gray-800' : 'border-white'" style="background-color: #6EE7B7;">
            <i x-show="selectedColor === '#6EE7B7'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#22D3EE'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#22D3EE' ? 'border-gray-800' : 'border-white'" style="background-color: #22D3EE;">
            <i x-show="selectedColor === '#22D3EE'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#6366F1'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#6366F1' ? 'border-gray-800' : 'border-white'" style="background-color: #6366F1;">
            <i x-show="selectedColor === '#6366F1'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#A78BFA'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#A78BFA' ? 'border-gray-800' : 'border-white'" style="background-color: #A78BFA;">
            <i x-show="selectedColor === '#A78BFA'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#E879F9'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#E879F9' ? 'border-gray-800' : 'border-white'" style="background-color: #E879F9;">
            <i x-show="selectedColor === '#E879F9'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#FB7185'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#FB7185' ? 'border-gray-800' : 'border-white'" style="background-color: #FB7185;">
            <i x-show="selectedColor === '#FB7185'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
          <button type="button" @click="selectedColor = '#9CA3A8'" class="w-8 h-8 rounded-full border-2 shadow-md hover:scale-110 transition flex items-center justify-center" :class="selectedColor === '#9CA3A8' ? 'border-gray-800' : 'border-white'" style="background-color: #9CA3A8;">
            <i x-show="selectedColor === '#9CA3A8'" class="fa-solid fa-check text-white text-sm font-black"></i>
          </button>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex gap-3 mb-6">
        <button type="button" @click="showEditModal = false" class="flex-1 py-3 px-4 rounded-lg font-semibold border-2 transition" style="color: #1d3e4c; border-color: #E8EEF1;">
          Cancel
        </button>
        <%= f.submit "Update Category", class: "flex-1 py-3 px-4 rounded-lg text-white font-semibold shadow-lg hover:shadow-xl transition transform hover:scale-[1.02]", style: "background: linear-gradient(135deg, #1d3e4c, #45606b);" %>
      </div>
    <% end %>

    <!-- Danger Zone -->
    <div class="pt-6 border-t border-gray-200">
      <p class="text-sm font-semibold mb-3" style="color: #DC2626;">
        <i class="fa-solid fa-triangle-exclamation mr-2"></i>Danger Zone
      </p>
      <p class="text-xs font-light mb-4" style="color: #566e78;">Deleting this category will archive it and all associated habits. This action can be undone.</p>
      <%= button_to "Delete Category", category_path(category),
          method: :delete,
          data: { confirm: "Are you sure you want to delete this category?" },
          class: "w-full py-2 px-4 rounded-lg font-semibold border-2 transition hover:bg-red-50",
          style: "color: #DC2626; border-color: #DC2626;" %>
    </div>
  </div>
</div>
