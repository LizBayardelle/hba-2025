<div class="flex h-screen bg-gray-50 relative">
  <%= render 'shared/sidebar' %>

  <!-- Mobile overlay -->
  <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 md:hidden hidden"></div>

  <!-- Menu flag button -->
  <button id="menu-button" class="fixed left-0 z-20 md:hidden rounded-r-lg shadow-lg flex items-center justify-center py-1.5 px-3 transition-all"
    style="top: 200px; background: linear-gradient(135deg, #1d3e4c, #45606b); writing-mode: vertical-rl;">
    <span class="text-white font-bold text-sm tracking-wider">MENU</span>
  </button>

  <script>
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    const menuButton = document.getElementById('menu-button');
    const closeButton = document.getElementById('sidebar-close');

    function openSidebar() {
      sidebar.classList.remove('-translate-x-full');
      sidebar.classList.add('translate-x-0');
      overlay.classList.remove('hidden');
      menuButton.classList.add('hidden');
    }

    function closeSidebar() {
      sidebar.classList.add('-translate-x-full');
      sidebar.classList.remove('translate-x-0');
      overlay.classList.add('hidden');
      menuButton.classList.remove('hidden');
    }

    menuButton.addEventListener('click', openSidebar);
    closeButton.addEventListener('click', closeSidebar);
    overlay.addEventListener('click', closeSidebar);
  </script>

  <!-- Main Content Area -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <%= render 'shared/navbar' %>

    <!-- Scrollable Content -->
    <main class="flex-1 overflow-y-auto bg-gray-50 p-8">
      <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <div class="mb-8">
          <h1 class="text-3xl font-bold display-font mb-2" style="color: #1d3e4c;">
            Edit Content
          </h1>
          <p class="text-sm font-light" style="color: #657b84;">
            Update the attached content for <%= @habit.name %>
          </p>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-lg p-8">
          <%= form_with model: [@habit, @habit_content], local: true do |f| %>
            <!-- Content Type (read-only display) -->
            <div class="mb-6">
              <label class="block text-sm font-semibold mb-2" style="color: #1d3e4c;">Content Type</label>
              <div class="px-4 py-3 rounded-lg bg-gray-100 font-light text-gray-600 capitalize">
                <%= @habit_content.content_type %>
              </div>
              <%= f.hidden_field :content_type %>
            </div>

            <!-- Title -->
            <div class="mb-6">
              <%= f.label :title, class: "block text-sm font-semibold mb-2", style: "color: #1d3e4c;" %>
              <%= f.text_field :title,
                  class: "w-full px-4 py-3 rounded-lg border-2 focus:outline-none transition font-light",
                  style: "border-color: #E8EEF1;" %>
            </div>

            <!-- URL Field (for youtube, video, link) -->
            <% if ['youtube', 'video', 'link'].include?(@habit_content.content_type) %>
              <div class="mb-6">
                <%= label_tag 'habit_content[metadata][url]', "URL", class: "block text-sm font-semibold mb-2", style: "color: #1d3e4c;" %>
                <%= text_field_tag 'habit_content[metadata][url]',
                    @habit_content.metadata['url'],
                    class: "w-full px-4 py-3 rounded-lg border-2 focus:outline-none transition font-light",
                    style: "border-color: #E8EEF1;" %>
              </div>
            <% end %>

            <!-- Document Body (for document type) -->
            <% if @habit_content.content_type == 'document' %>
              <div class="mb-6">
                <%= f.label :body, "Document Content", class: "block text-sm font-semibold mb-2", style: "color: #1d3e4c;" %>
                <%= f.text_area :body,
                    rows: 10,
                    class: "w-full px-4 py-3 rounded-lg border-2 focus:outline-none transition font-light",
                    style: "border-color: #E8EEF1;" %>
              </div>
            <% end %>

            <!-- Actions -->
            <div class="flex gap-3">
              <%= f.submit "Update Content",
                  class: "px-6 py-3 rounded-lg text-white font-semibold shadow-lg hover:shadow-xl transition cursor-pointer",
                  style: "background: linear-gradient(135deg, #1d3e4c, #45606b);" %>
              <%= link_to "Cancel", habit_habit_content_path(@habit, @habit_content),
                  class: "px-6 py-3 rounded-lg font-semibold border-2 transition",
                  style: "color: #1d3e4c; border-color: #E8EEF1;" %>
            </div>
          <% end %>
        </div>
      </div>
    </main>
  </div>
</div>
